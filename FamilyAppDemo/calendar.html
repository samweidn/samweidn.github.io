<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Family App Demo</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap"
        rel="stylesheet">
    <!-- bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <!-- styles -->
    <link rel="stylesheet" href="css/familyapp.css">
</head>
<div class="phonescreen">

    <body>
        <!-- HEADER -->
        <header class="fixed-top">
            <div class="logo">
                <p>Family Connnection</p>
            </div>
            <div class="accountDiv">
                <img class="accountIconImage" src="images/account.jpg" alt="">
                <p>Account</p>
            </div>
        </header>

        <!-- MAIN CONTENT -->
        <main class="container">
            <div class="breadcrumbPageTitle">
                <h1>Shared Calendar</h1>
            </div>
            <div>
                <h4>Unread Events</h4>
                <div class="upcomingEventsTableContainer">
                    <table class="table">
                        <tbody id="eventsTRContainer"></tbody>
                    </table>
                </div>
            </div>

            <img class="embedCalendar" src="images/calendar.png" alt="">

            <div>
                <h4>My Events For November 7th</h4>
                <table class="table">
                    <tbody>
                        <tr class="unknownPerson">
                            <th scope="row">
                                Dinner at Mom + Dads
                                <p>
                                    <span class="thinText ">Mom, Dad</span><br>
                                    <span class="thinText">6:30pm - 8:00pm</span>
                                </p>

                            </th>
                            <td class="actionButtons">
                                <button type="button" class="btn btn-primary">Edit</button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>


        </main>

        <!-- NAVIGATION -->
        <nav class="fixed-bottom">
            <ul>
                <a href="Index.html">
                    <li>
                        <svg class="navSVG" xmlns="http://www.w3.org/2000/svg" id="Layer_2" data-name="Layer 2"
                            viewBox="0 0 68.32 68.32">
                            <g id="Layer_1-2" data-name="Layer 1">
                                <polygon
                                    points="68.32 24.84 34.16 0 0 24.84 0 68.32 21.49 68.32 21.49 38.11 46.33 38.11 46.33 68.32 68.32 68.32 68.32 24.84"
                                    fill="#075081" />
                            </g>
                        </svg>
                        <p>Family</p>
                    </li>
                </a>
                <a href="map.html">
                    <li>
                        <svg class="navSVG" xmlns="http://www.w3.org/2000/svg" id="Layer_2" data-name="Layer 2"
                            viewBox="0 0 59.21 71.63">
                            <g id="Layer_1-2" data-name="Layer 1">
                                <path
                                    d="M29.61,0C13.28,0,0,13.28,0,29.61c0,9.77,3.46,21.58,28.57,41.67.3.24.67.36,1.04.36s.73-.12,1.04-.36c14.84-11.87,28.57-25.14,28.57-41.67S45.93,0,29.61,0ZM29.61,42.03c-6.86,0-12.42-5.56-12.42-12.42s5.56-12.42,12.42-12.42,12.42,5.56,12.42,12.42-5.56,12.42-12.42,12.42Z"
                                    fill="#075081" />
                            </g>
                        </svg>
                        <p>Map</p>
                    </li>
                </a>
                <a href="calendar.html">
                    <li>
                        <svg class="navSVG" xmlns="http://www.w3.org/2000/svg" id="Layer_2" data-name="Layer 2"
                            viewBox="0 0 71.63 65.42">
                            <g id="Layer_1-2" data-name="Layer 1">
                                <g>
                                    <path d="M1.66,57.55c0,3.43,2.78,6.21,6.21,6.21" fill="none" stroke="#fff"
                                        stroke-linecap="round" stroke-linejoin="round" stroke-width="3.31" />
                                    <path d="M69.98,57.55c0,3.43-2.78,6.21-6.21,6.21" fill="none" stroke="#fff"
                                        stroke-linecap="round" stroke-linejoin="round" stroke-width="3.31" />
                                    <line x1="7.87" y1="63.77" x2="63.77" y2="63.77" fill="none" stroke="#fff"
                                        stroke-linecap="round" stroke-linejoin="round" stroke-width="3.31" />
                                    <line x1="1.66" y1="57.55" x2="1.66" y2="7.87" fill="none" stroke="#fff"
                                        stroke-linecap="round" stroke-linejoin="round" stroke-width="3.31" />
                                    <line x1="69.98" y1="57.55" x2="69.98" y2="7.87" fill="none" stroke="#fff"
                                        stroke-linecap="round" stroke-linejoin="round" stroke-width="3.31" />
                                    <line x1="1.66" y1="7.87" x2="69.98" y2="7.87" fill="none" stroke="#fff"
                                        stroke-linecap="round" stroke-linejoin="round" stroke-width="3.31" />
                                    <line x1="17.18" y1="1.66" x2="17.18" y2="14.08" fill="none" stroke="#fff"
                                        stroke-linecap="round" stroke-linejoin="round" stroke-width="3.31" />
                                    <line x1="29.61" y1="1.66" x2="29.61" y2="14.08" fill="none" stroke="#fff"
                                        stroke-linecap="round" stroke-linejoin="round" stroke-width="3.31" />
                                    <line x1="42.03" y1="1.66" x2="42.03" y2="14.08" fill="none" stroke="#fff"
                                        stroke-linecap="round" stroke-linejoin="round" stroke-width="3.31" />
                                    <line x1="54.45" y1="1.66" x2="54.45" y2="14.08" fill="none" stroke="#fff"
                                        stroke-linecap="round" stroke-linejoin="round" stroke-width="3.31" />
                                    <line x1="69.98" y1="26.5" x2="1.66" y2="26.5" fill="none" stroke="#fff"
                                        stroke-linecap="round" stroke-linejoin="round" stroke-width="3.31" />
                                    <path
                                        d="M2.67,27.26v30.98c0,3.05,2.47,5.52,5.52,5.52h56.7c2.81,0,5.08-2.28,5.08-5.08v-31.42H2.67ZM18.81,51.67c-.02.1-.05.21-.09.31-.04.1-.09.19-.15.28-.06.09-.13.18-.21.25-.31.31-.74.49-1.17.49-.11,0-.22,0-.32-.03-.11-.02-.21-.06-.31-.1-.11-.04-.2-.09-.29-.15-.09-.06-.18-.13-.25-.21-.08-.07-.15-.16-.21-.25-.06-.09-.11-.18-.15-.28-.04-.1-.07-.21-.1-.31-.02-.11-.03-.22-.03-.33s.01-.21.03-.32c.03-.11.06-.21.1-.31.04-.1.09-.2.15-.29s.13-.17.21-.25c.07-.07.16-.14.25-.2.09-.06.18-.12.29-.16.1-.04.2-.07.31-.09.54-.11,1.11.07,1.49.45.08.08.15.16.21.25s.11.19.15.29c.04.1.07.2.09.31.03.11.04.21.04.32s-.01.22-.04.33ZM18.36,40.09c-.07.08-.16.15-.25.21-.09.06-.19.11-.29.15-.1.04-.2.07-.31.1-.1.02-.21.03-.32.03-.44,0-.86-.18-1.17-.49-.31-.3-.49-.73-.49-1.17s.18-.87.49-1.17c.38-.39.96-.56,1.49-.45.11.02.21.05.31.09.1.04.2.09.29.15.09.06.18.13.25.21.31.31.49.73.49,1.17s-.18.87-.49,1.17ZM31.24,51.67c-.03.1-.06.21-.1.31-.04.1-.09.19-.15.28-.06.09-.13.18-.21.25-.07.08-.16.15-.25.21-.09.06-.19.11-.29.15-.1.04-.2.08-.31.1-.1.02-.21.03-.32.03-.43,0-.86-.18-1.17-.49-.31-.3-.49-.73-.49-1.17,0-.11,0-.21.04-.32.02-.11.05-.21.09-.31.04-.1.09-.2.15-.29s.13-.17.21-.25c.39-.38.96-.56,1.49-.45.11.02.21.05.31.09.1.04.2.1.29.16.09.06.18.13.25.2.08.08.15.16.21.25.06.09.11.19.15.29.04.1.07.2.1.31.02.11.03.21.03.32s-.01.22-.03.33ZM30.78,40.09c-.31.31-.73.49-1.17.49-.11,0-.22,0-.32-.03-.11-.03-.21-.06-.31-.1s-.2-.09-.29-.15c-.09-.06-.18-.13-.25-.21-.31-.3-.49-.73-.49-1.17s.18-.86.49-1.17c.07-.08.16-.15.25-.21.09-.06.19-.11.29-.15.1-.04.2-.07.31-.09.53-.11,1.11.06,1.49.45.31.31.49.73.49,1.17s-.18.87-.49,1.17ZM43.66,51.67c-.02.1-.06.21-.1.31-.04.1-.09.19-.15.28-.06.09-.13.18-.21.25-.31.31-.73.49-1.17.49-.11,0-.21,0-.32-.03-.11-.02-.21-.06-.31-.1s-.2-.09-.29-.15c-.09-.06-.17-.13-.25-.21-.08-.07-.14-.16-.21-.25-.06-.09-.11-.18-.15-.28-.04-.1-.07-.21-.09-.31-.02-.11-.04-.22-.04-.33s.02-.21.04-.32c.02-.11.05-.21.09-.31.04-.1.09-.2.15-.29.07-.09.13-.17.21-.25.08-.07.16-.14.25-.2.09-.06.19-.12.29-.16s.2-.07.31-.09c.53-.11,1.11.07,1.49.45.08.08.15.16.21.25s.11.19.15.29c.04.1.08.2.1.31.02.11.03.21.03.32s0,.22-.03.33ZM43.2,40.09c-.3.31-.73.49-1.17.49-.11,0-.22,0-.32-.03-.11-.03-.21-.06-.31-.1s-.2-.09-.29-.15c-.09-.06-.17-.13-.25-.21-.31-.3-.48-.73-.48-1.17s.17-.86.48-1.17c.08-.08.16-.15.25-.21.09-.06.19-.11.29-.15.1-.04.2-.07.31-.09.54-.11,1.11.06,1.49.45.31.3.49.73.49,1.17s-.18.87-.49,1.17ZM56.08,51.67c-.02.1-.06.21-.1.31-.04.1-.09.19-.15.28-.06.09-.13.18-.2.25-.08.08-.17.15-.26.21-.09.06-.18.11-.28.15s-.21.08-.31.1c-.11.02-.22.03-.33.03-.43,0-.86-.18-1.17-.49-.08-.07-.14-.16-.2-.25-.06-.09-.12-.18-.16-.28-.04-.1-.07-.21-.09-.31-.02-.11-.03-.22-.03-.33s.01-.21.03-.32c.02-.11.05-.21.09-.31.04-.1.1-.2.16-.29s.12-.17.2-.25c.39-.38.96-.56,1.5-.45.1.02.21.05.31.09s.19.1.28.16c.09.06.18.13.26.2.07.08.14.16.2.25s.11.19.15.29c.04.1.08.2.1.31.02.11.03.21.03.32s0,.22-.03.33ZM56.08,39.25c-.02.1-.05.21-.1.31-.04.1-.09.19-.15.28s-.13.18-.2.25c-.31.31-.74.49-1.18.49s-.86-.18-1.17-.49c-.07-.07-.14-.16-.2-.25s-.11-.18-.16-.28c-.04-.1-.07-.21-.09-.31-.02-.11-.03-.22-.03-.33s.01-.22.03-.32c.02-.11.05-.21.09-.31.05-.1.1-.2.16-.29s.13-.17.2-.25c.62-.62,1.73-.62,2.35,0,.07.08.14.16.2.25s.11.19.15.29c.05.1.08.2.1.31.02.1.03.21.03.32s0,.22-.03.33Z"
                                        fill="#fff" />
                                </g>
                            </g>
                        </svg>
                        <p class="activeNav">Calendar</p>
                    </li>
                </a>
                <a href="reminder.html">
                    <li>
                        <svg class="navSVG" xmlns="http://www.w3.org/2000/svg" id="Layer_2" data-name="Layer 2"
                            viewBox="0 0 71.63 71.49">
                            <g id="Layer_1-2" data-name="Layer 1">
                                <line x1="35.82" y1="1.66" x2="35.82" y2="7.87" fill="none" stroke="#075081"
                                    stroke-linecap="round" stroke-linejoin="round" stroke-width="3.31" />
                                <path
                                    d="M63.77,57.55H7.87c0-6.21,6.21-12.42,6.21-27.95,0-12.01,9.73-21.74,21.74-21.74s21.74,9.73,21.74,21.74c0,15.53,6.21,21.74,6.21,27.95Z"
                                    fill="#075081" stroke="#075081" stroke-linecap="round" stroke-linejoin="round"
                                    stroke-width="3.31" />
                                <path d="M55.46,1.66c8.78,6.18,14.51,16.4,14.51,27.95" fill="none" stroke="#075081"
                                    stroke-linecap="round" stroke-linejoin="round" stroke-width="3.31" />
                                <path d="M1.66,29.61C1.66,18.05,7.39,7.84,16.17,1.66" fill="none" stroke="#075081"
                                    stroke-linecap="round" stroke-linejoin="round" stroke-width="3.31" />
                                <path
                                    d="M35.82,71.49c5.75,0,10.44-4.49,10.79-10.15h-21.59c.35,5.66,5.04,10.15,10.79,10.15Z"
                                    fill="#075081" />
                            </g>
                        </svg>
                        <p>Reminders</p>
                    </li>
                </a>
            </ul>
        </nav>
        <!-- Scripts -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
            crossorigin="anonymous"></script>
    </body>
</div>

</html>

<script>
    setCalendarEvents();
    function setCalendarEvents() {
        let allFamilyMemberEvents = JSON.parse(sessionStorage.getItem('jsonAllFamilyMemberEvents'));
        const sortedFamilyMemberEvents = sortEventsByDate(allFamilyMemberEvents);

        const eventsTable = document.querySelector('#eventsTRContainer');

        sortedFamilyMemberEvents.forEach(event => {

            if (event.eventAcknowledged) {
                return;
            }

            let reminderBadge = '';

            if (event.reminderSet === true) {
                reminderBadge = '<span class="badge bg-success reminderBadge">reminder set</span>';
            } else {
                reminderBadge = `
                            <span class="btn btn-primary btn-sm mt-2 reminderBadge">
                                <a href="reminderNew.html" onclick="getEventData(${event.uniqueId})">
                                    set reminder
                                    <svg width="15px" height="15px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                                        <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                                        <g id="SVGRepo_iconCarrier">
                                            <path d="M7 17L17 7M17 7H8M17 7V16"
                                                stroke="#ffffff" stroke-width="2"
                                                stroke-linecap="round" stroke-linejoin="round"></path>
                                        </g>
                                    </svg>
                                </a>
                            </span>
                        `;
            }

            var familyEventColor = 'unknownPerson';

            if (event.familyMember.length == 1) {
                familyEventColor = (event.familyMember[0]).toLowerCase();
            }

            var familyMembersOnEvent = event.familyMember.join(', ');

            // svg from https://www.svgrepo.com/svg/485671/checkmark
            const html = `
                    <tr id="row${event.uniqueId}" data-event-id="${event.uniqueId}" class="${familyEventColor}">
                        <th scope="row">
                            ${event.eventName}<br>
                            <p>
                            <span class="thinText ">${familyMembersOnEvent}</span><br>
                            <span class="thinText">${event.eventDate}</span>
                            </p>
                           ${reminderBadge}
                        </th>
                        <td class="actionButtons">
                            <button onclick="removeRow(row${event.uniqueId})" type="button" class="btn btn-primary btn-sm mt-4"><svg fill="#fff" width="25px" height="25px" viewBox="0 0 32 32" version="1.1" xmlns="http://www.w3.org/2000/svg" stroke="#fff"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <title>checkmark</title> <path d="M16 3c-7.18 0-13 5.82-13 13s5.82 13 13 13 13-5.82 13-13-5.82-13-13-13zM23.258 12.307l-9.486 9.485c-0.238 0.237-0.623 0.237-0.861 0l-0.191-0.191-0.001 0.001-5.219-5.256c-0.238-0.238-0.238-0.624 0-0.862l1.294-1.293c0.238-0.238 0.624-0.238 0.862 0l3.689 3.716 7.756-7.756c0.238-0.238 0.624-0.238 0.862 0l1.294 1.294c0.239 0.237 0.239 0.623 0.001 0.862z"></path> </g></svg></button>
                        </td>
                    </tr>
                    `;

            eventsTable.insertAdjacentHTML('beforeend', html);

        });

    }

    function getEventData(eventId) {
        let familyMemberEvents = JSON.parse(sessionStorage.getItem("jsonAllFamilyMemberEvents"));
        let familyMemberEvent = familyMemberEvents.filter(event => event.uniqueId == eventId);

        const notificationDetails = {
            notificationEvent: familyMemberEvent[0].eventName,
            notificationDate: familyMemberEvent[0].eventDateValue,
            notificationPerson: familyMemberEvent[0].familyMember,
            notificationEventId: familyMemberEvent[0].uniqueId
        }

        let jsonNotificationDetails = JSON.stringify(notificationDetails);
        sessionStorage.setItem("jsonNotificationDetails", jsonNotificationDetails);
    }

    function sortEventsByDate(events) {
        return events.sort((a, b) => {
            const dateA = new Date(a.eventDateValue);
            const dateB = new Date(b.eventDateValue);
            return dateA - dateB; // earliest first
        });
    }

    function removeRow(row) {
        let allFamilyMemberEvents = JSON.parse(sessionStorage.getItem('jsonAllFamilyMemberEvents'));
        let event = allFamilyMemberEvents.filter(event => event.uniqueId == row.dataset.eventId)[0];
        event.eventAcknowledged = true;
        sessionStorage.setItem('jsonAllFamilyMemberEvents', JSON.stringify(allFamilyMemberEvents));
        row.remove();
    }
</script>